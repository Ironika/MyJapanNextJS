{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nvar _jsxFileName = \"/Users/kevhoque/Documents/MyTest/myJapan/pages/animes.js\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\nimport { getAnimes } from '../helpers/Animes';\nimport { dateDiff } from '../helpers/Shared';\nimport debounce from \"lodash.debounce\";\nimport { ParallaxProvider } from 'react-scroll-parallax';\nimport { ParallaxBanner } from 'react-scroll-parallax';\nimport Card from '../components/Animes/Card';\nimport Loader from '../components/Loader/Loader';\nimport banner from '../public/img/banner.jpg';\n\nvar Animes = function Animes(props) {\n  var pageToDisplay = 9;\n\n  var _useState = useState(props.animes || []),\n      animes = _useState[0],\n      setAnimes = _useState[1];\n\n  var _useState2 = useState([]),\n      displayedAnimes = _useState2[0],\n      setDisplayedAnimes = _useState2[1];\n\n  var _useState3 = useState(true),\n      hasMore = _useState3[0],\n      setHasMore = _useState3[1];\n\n  var _useState4 = useState(true),\n      loader = _useState4[0],\n      setLoader = _useState4[1];\n\n  var _useState5 = useState(false),\n      deepLoader = _useState5[0],\n      setDeepLoader = _useState5[1];\n\n  useEffect(function () {\n    var fetchDatas = function fetchDatas() {\n      var _animes;\n\n      return _regeneratorRuntime.async(function fetchDatas$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(getAnimes());\n\n            case 2:\n              _animes = _context.sent;\n              setAnimes(_animes);\n              setDisplayedAnimes(_animes.slice(0, pageToDisplay));\n              setLoader(false);\n\n              if (deepLoader) {\n                setDeepLoader(false);\n              }\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    };\n\n    var cache = JSON.parse(localStorage.getItem('cache'));\n\n    if (!props.animes && cache.animes) {\n      var _animes2 = cache.animes;\n      setAnimes(_animes2);\n      setDisplayedAnimes(_animes2.slice(0, pageToDisplay));\n      setLoader(false);\n\n      if (dateDiff(new Date(cache.animesDate), new Date()).min > 10) {\n        fetchDatas();\n        setDeepLoader(true);\n      }\n    } else {\n      fetchDatas();\n    }\n\n    window.onscroll = debounce(function () {\n      if (!hasMore) return;\n      var scroll = window.innerHeight + document.documentElement.scrollTop;\n\n      if (scroll === document.documentElement.offsetHeight) {\n        var nbToDisplay = displayedAnimes.length + pageToDisplay;\n\n        if (nbToDisplay > _animes.length) {\n          nbToDisplay = _animes.length;\n          setHasMore(false);\n        }\n\n        setDisplayedAnimes(_animes.slice(0, nbToDisplay));\n      }\n    }, 100);\n  }, [deepLoader]);\n  return __jsx(\"div\", {\n    className: \"Animes\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61\n    },\n    __self: this\n  }, __jsx(ParallaxProvider, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62\n    },\n    __self: this\n  }, __jsx(ParallaxBanner, {\n    className: \"homescreen banner\",\n    layers: [{\n      image: banner,\n      amount: 0.5\n    }],\n    style: {\n      height: '300px'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63\n    },\n    __self: this\n  }, __jsx(\"h1\", {\n    className: \"title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64\n    },\n    __self: this\n  }, \"ANIMES\")), deepLoader && __jsx(Loader, {\n    style: {\n      marginTop: '20px'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66\n    },\n    __self: this\n  }), __jsx(\"div\", {\n    className: \"card-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67\n    },\n    __self: this\n  }, loader ? __jsx(Loader, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 68\n    },\n    __self: this\n  }) : displayedAnimes.map(function (item, index) {\n    return __jsx(Card, {\n      key: index,\n      item: item,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 70\n      },\n      __self: this\n    });\n  }))));\n};\n\nAnimes.getInitialProps = function _callee(context) {\n  var animes;\n  return _regeneratorRuntime.async(function _callee$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          if (!context.req) {\n            _context2.next = 3;\n            break;\n          }\n\n          animes = getAnimes();\n          return _context2.abrupt(\"return\", {\n            animes: animes\n          });\n\n        case 3:\n          return _context2.abrupt(\"return\", {});\n\n        case 4:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  });\n};\n\nexport default Animes;","map":{"version":3,"sources":["/Users/kevhoque/Documents/MyTest/myJapan/pages/animes.js"],"names":["React","useState","useEffect","getAnimes","dateDiff","debounce","ParallaxProvider","ParallaxBanner","Card","Loader","banner","Animes","props","pageToDisplay","animes","setAnimes","displayedAnimes","setDisplayedAnimes","hasMore","setHasMore","loader","setLoader","deepLoader","setDeepLoader","fetchDatas","_animes","slice","cache","JSON","parse","localStorage","getItem","Date","animesDate","min","window","onscroll","scroll","innerHeight","document","documentElement","scrollTop","offsetHeight","nbToDisplay","length","image","amount","height","marginTop","map","item","index","getInitialProps","context","req"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { getAnimes } from '../helpers/Animes'\nimport { dateDiff } from '../helpers/Shared'\nimport debounce from \"lodash.debounce\";\nimport { ParallaxProvider } from 'react-scroll-parallax';\nimport { ParallaxBanner } from 'react-scroll-parallax';\nimport Card from '../components/Animes/Card'\nimport Loader from '../components/Loader/Loader'\nimport banner from '../public/img/banner.jpg'\n\nconst Animes = (props) => {\n    const pageToDisplay = 9\n    const [animes, setAnimes] = useState(props.animes || [])\n    const [displayedAnimes, setDisplayedAnimes] = useState([])\n    const [hasMore, setHasMore] = useState(true)\n    const [loader, setLoader] = useState(true)\n    const [deepLoader, setDeepLoader] = useState(false)\n\n    useEffect(() => {\n        const fetchDatas = async () => {\n            const _animes = await getAnimes()\n            setAnimes(_animes)\n            setDisplayedAnimes(_animes.slice(0, pageToDisplay))\n            setLoader(false)\n            if(deepLoader) {\n                setDeepLoader(false)\n            }\n        }\n\n        const cache = JSON.parse(localStorage.getItem('cache'))\n        if(!props.animes && cache.animes) {\n            const _animes = cache.animes\n            setAnimes(_animes)\n            setDisplayedAnimes(_animes.slice(0, pageToDisplay))\n            setLoader(false)\n            if(dateDiff(new Date(cache.animesDate), new Date()).min > 10) {\n                fetchDatas()\n                setDeepLoader(true)\n            }\n        } else {\n            fetchDatas()\n        }\n\n\n        window.onscroll = debounce(() => {\n            if (!hasMore) return\n            let scroll = window.innerHeight + document.documentElement.scrollTop\n            if ( scroll === document.documentElement.offsetHeight) {\n                let nbToDisplay = displayedAnimes.length + pageToDisplay\n                if(nbToDisplay > _animes.length) {\n                    nbToDisplay = _animes.length\n                    setHasMore(false)\n                }\n                setDisplayedAnimes(_animes.slice(0, nbToDisplay))\n            }\n        }, 100);\n\n    }, [deepLoader]);\n\n    return (\n        <div className=\"Animes\">\n            <ParallaxProvider>\n                <ParallaxBanner className=\"homescreen banner\" layers={[{ image: banner, amount: 0.5 }]} style={{ height: '300px' }}>\n                    <h1 className=\"title\">ANIMES</h1>\n                </ParallaxBanner>\n                {deepLoader && <Loader style={{marginTop: '20px'}} />}\n                <div className=\"card-container\">\n                    {   loader ? <Loader /> :\n                        displayedAnimes.map((item, index) =>\n                            <Card key={index} item={item} />\n                        )\n                    }\n                </div>\n            </ParallaxProvider>\n        </div>\n    );\n}\n\nAnimes.getInitialProps = async (context) => {\n    if(context.req) {\n        const animes = getAnimes();\n        return {animes}\n    }\n    return {}\n}\n\nexport default Animes;\n"]},"metadata":{},"sourceType":"module"}