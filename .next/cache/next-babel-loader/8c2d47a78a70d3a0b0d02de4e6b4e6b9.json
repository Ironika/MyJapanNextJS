{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nvar _jsxFileName = \"/Users/kevhoque/Documents/MyTest/myJapan/pages/news.js\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\nimport { getNews, getApiNews } from '../helpers/News';\nimport { dateDiff } from '../helpers/Shared';\nimport debounce from \"lodash.debounce\";\nimport { ParallaxProvider } from 'react-scroll-parallax';\nimport { ParallaxBanner } from 'react-scroll-parallax';\nimport Card from '../components/News/Card';\nimport Loader from '../components/Loader/Loader';\nimport banner from '../public/img/banner.jpg';\n\nvar News = function News() {\n  var pageToDisplay = 12;\n\n  var _useState = useState([]),\n      news = _useState[0],\n      setNews = _useState[1];\n\n  var _useState2 = useState([]),\n      displayedNews = _useState2[0],\n      setDisplayedNews = _useState2[1];\n\n  var _useState3 = useState(true),\n      hasMore = _useState3[0],\n      setHasMore = _useState3[1];\n\n  var _useState4 = useState(true),\n      loader = _useState4[0],\n      setLoader = _useState4[1];\n\n  useEffect(function () {\n    window.onscroll = debounce(function () {\n      if (!hasMore) return;\n      var scroll = window.innerHeight + document.documentElement.scrollTop;\n      if (scroll === document.documentElement.offsetHeight) loadItems();\n    }, 100);\n  }, [displayedNews]);\n  useEffect(function () {\n    var fetchDatas = function fetchDatas() {\n      var currentNews;\n      return _regeneratorRuntime.async(function fetchDatas$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return _regeneratorRuntime.awrap(getApiNews());\n\n            case 2:\n              currentNews = _context.sent;\n              setNews(currentNews);\n              setDisplayedNews(currentNews.slice(0, pageToDisplay));\n              setLoader(false);\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      });\n    };\n\n    var cache = JSON.parse(localStorage.getItem('cache'));\n\n    if (cache.news) {\n      var currentNews = cache.news;\n      setNews(currentNews);\n      setDisplayedNews(currentNews.slice(0, pageToDisplay));\n      setLoader(false);\n      if (dateDiff(new Date(cache.newsDate), new Date()).min > 5) fetchDatas();\n    } else {\n      fetchDatas();\n    }\n  }, []);\n\n  var loadItems = function loadItems() {\n    var nbToDisplay = displayedNews.length + pageToDisplay;\n\n    if (nbToDisplay > news.length) {\n      nbToDisplay = news.length;\n      setHasMore(false);\n    }\n\n    setDisplayedNews(news.slice(0, nbToDisplay));\n  };\n\n  return __jsx(\"div\", {\n    className: \"News\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59\n    },\n    __self: this\n  }, __jsx(ParallaxProvider, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 60\n    },\n    __self: this\n  }, __jsx(ParallaxBanner, {\n    className: \"homescreen banner\",\n    layers: [{\n      image: banner,\n      amount: 0.5\n    }],\n    style: {\n      height: '300px'\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61\n    },\n    __self: this\n  }, __jsx(\"h1\", {\n    className: \"title\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 62\n    },\n    __self: this\n  }, \"NEWS\")), __jsx(\"div\", {\n    className: \"card-container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64\n    },\n    __self: this\n  }, loader ? __jsx(Loader, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65\n    },\n    __self: this\n  }) : displayedNews.map(function (item, index) {\n    return __jsx(Card, {\n      key: index,\n      news: item,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 67\n      },\n      __self: this\n    });\n  }))));\n};\n\nNews.getInitialProps = function _callee(context) {\n  var news;\n  return _regeneratorRuntime.async(function _callee$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          if (!context.req) {\n            _context2.next = 3;\n            break;\n          }\n\n          news = getApiNews();\n          return _context2.abrupt(\"return\", {\n            news: news\n          });\n\n        case 3:\n          return _context2.abrupt(\"return\", {});\n\n        case 4:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  });\n};\n\nexport default News;","map":{"version":3,"sources":["/Users/kevhoque/Documents/MyTest/myJapan/pages/news.js"],"names":["React","useState","useEffect","getNews","getApiNews","dateDiff","debounce","ParallaxProvider","ParallaxBanner","Card","Loader","banner","News","pageToDisplay","news","setNews","displayedNews","setDisplayedNews","hasMore","setHasMore","loader","setLoader","window","onscroll","scroll","innerHeight","document","documentElement","scrollTop","offsetHeight","loadItems","fetchDatas","currentNews","slice","cache","JSON","parse","localStorage","getItem","Date","newsDate","min","nbToDisplay","length","image","amount","height","map","item","index","getInitialProps","context","req"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { getNews, getApiNews } from '../helpers/News'\nimport { dateDiff } from '../helpers/Shared'\nimport debounce from \"lodash.debounce\";\nimport { ParallaxProvider } from 'react-scroll-parallax';\nimport { ParallaxBanner } from 'react-scroll-parallax';\nimport Card from '../components/News/Card'\nimport Loader from '../components/Loader/Loader'\nimport banner from '../public/img/banner.jpg'\n\nconst News = () => {\n    const pageToDisplay = 12\n    const [news, setNews] = useState([])\n    const [displayedNews, setDisplayedNews] = useState([])\n    const [hasMore, setHasMore] = useState(true)\n    const [loader, setLoader] = useState(true)\n\n    useEffect(() => {\n        window.onscroll = debounce(() => {\n            if (!hasMore) return\n            let scroll = window.innerHeight + document.documentElement.scrollTop\n            if ( scroll === document.documentElement.offsetHeight)\n                loadItems()\n        }, 100);\n    }, [displayedNews])\n\n    useEffect(() => {\n        const fetchDatas = async () => {\n            const currentNews = await getApiNews()\n            setNews(currentNews)\n            setDisplayedNews(currentNews.slice(0, pageToDisplay))\n            setLoader(false)\n        }\n\n        const cache = JSON.parse(localStorage.getItem('cache'))\n        if(cache.news) {\n            const currentNews = cache.news\n            setNews(currentNews)\n            setDisplayedNews(currentNews.slice(0, pageToDisplay))\n            setLoader(false)\n            if(dateDiff(new Date(cache.newsDate), new Date()).min > 5)\n                fetchDatas()\n        } else {\n            fetchDatas()\n        }\n\n    }, []);\n\n    const loadItems = () => {\n        let nbToDisplay = displayedNews.length + pageToDisplay\n        if(nbToDisplay > news.length) {\n            nbToDisplay = news.length\n            setHasMore(false)\n        }\n        setDisplayedNews(news.slice(0, nbToDisplay))\n    }\n\n    return (\n        <div className=\"News\">\n            <ParallaxProvider>\n                <ParallaxBanner className=\"homescreen banner\" layers={[{ image: banner, amount: 0.5 }]} style={{ height: '300px' }}>\n                    <h1 className=\"title\">NEWS</h1>\n                </ParallaxBanner>\n                <div className=\"card-container\">\n                    {   loader ? <Loader /> :\n                        displayedNews.map((item, index) =>\n                            <Card key={index} news={item} />\n                        )\n                    }\n                </div>\n            </ParallaxProvider>\n        </div>\n    );\n}\n\nNews.getInitialProps = async (context) => {\n    if(context.req) {\n        const news = getApiNews();\n        return {news}\n    }\n    return {}\n}\n\nexport default News;\n"]},"metadata":{},"sourceType":"module"}